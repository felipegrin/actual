import{j as e,r as x,aw as z,c3 as L,T as b,t as g,ds as W,V as h,bP as j,H as k,dt as M,du as _,dv as w,dw as F,dh as G,bz as J,dx as K,dy as A,as as U,aj as Z,s as q,ap as I,v as R,M as Q,cV as B,dz as X,aK as v,aA as ee,aJ as te,dA as N,dB as D,dC as se,c_ as E,m as S,y as ne,dD as le,dE as ae,dF as re,i as ie}from"./index.dmJdCxUe.js";const V=t=>e.jsx("svg",{...t,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",style:{color:"inherit",...t.style},children:e.jsx("path",{d:"m12 12 8-8V0H0v4l8 8v8l4-4v-4z",fill:"currentColor"})}),oe=x.forwardRef((t,n)=>e.jsx(z,{ref:n,variant:"bare","aria-label":"Menu",...t,children:e.jsx(L,{width:15,height:15,style:{transform:"rotateZ(90deg)"}})}));oe.displayName="MenuButton";function ue({conditionsOp:t,onChange:n,conditions:s}){return s.length>1?e.jsxs(b,{style:{color:g.pageText,marginTop:11,marginRight:5},children:[e.jsx(W,{style:{display:"inline-flex"},fields:[["and","all"],["or","any"]],value:t,onChange:n}),"of:"]}):e.jsx(h,{})}function de({onClick:t}){return e.jsx(j,{type:"bare",onClick:t,children:e.jsx(V,{width:15,height:15})})}function ce({onClick:t}){const{t:n}=k();return e.jsxs(j,{type:"bare",onClick:t,title:n("Filters"),children:[e.jsx(V,{style:{width:12,height:12,marginRight:5}})," Filter"]})}function C({op:t,selected:n,style:s,onClick:r}){return e.jsx(j,{type:"bare",style:{backgroundColor:g.pillBackground,marginBottom:5,...s,...n&&{color:g.buttonNormalSelectedText,"&,:hover,:active":{backgroundColor:g.buttonNormalSelectedBackground,color:g.buttonNormalSelectedText}}},onClick:r,children:M(t)})}function P({field:t,options:n,value:s}){if(t==="date"&&typeof s=="string"){if(s.length===7)return"month";if(s.length===4)return"year"}if(t==="amount"){if(n&&n.inflow)return"amount-inflow";if(n&&n.outflow)return"amount-outflow"}return t}function pe(t,n){let s;switch(t){case"amount":switch(n){case"amount-inflow":s={inflow:!0};break;case"amount-outflow":s={outflow:!0};break}break;case"date":switch(n){case"month":s={month:!0};break;case"year":s={year:!0};break}break}return s}function H(t,n){switch(n.type){case"set-op":{const s=w.get(t.field);let r=t.value;return(s==="id"||s==="string")&&(n.op==="contains"||n.op==="matches"||n.op==="is"||n.op==="doesNotContain"||n.op==="isNot"||n.op==="hasTags")&&(r=null),{...t,op:n.op,value:r}}case"set-value":{const{value:s}=_(n.value,{type:w.get(t.field)});return{...t,value:s}}default:throw new Error(`Unhandled action type: ${n.type}`)}}let T=!1;const fe=["date","account","payee","notes","category","amount","cleared","reconciled","saved"].map(t=>[t,F(t)]);function Y({field:t,initialSubfield:n=t,op:s,value:r,dispatch:u,onApply:p}){const{t:i}=k(),[f,d]=x.useState(n),c=x.useRef(),m=x.useRef(null);x.useEffect(()=>{m.current!==s&&c.current&&c.current.focus(),m.current=s},[s]);const l=w.get(t);let o=A[l].ops.filter(a=>a!=="isbetween");return(f==="month"||f==="year")&&(o=["is"]),e.jsxs(X,{children:[e.jsx(h,{style:{marginBottom:10},children:e.jsxs(v,{direction:"row",align:"flex-start",children:[t==="amount"||t==="date"?e.jsx(ee,{options:t==="amount"?[["amount",i("Amount")],["amount-inflow",i("Amount (inflow)")],["amount-outflow",i("Amount (outflow)")]]:t==="date"?[["date",i("Date")],["month",i("Month")],["year",i("Year")]]:null,value:f,onChange:a=>{d(a),(a==="month"||a==="year")&&u({type:"set-op",op:"is"})}}):B(F(t)),e.jsx(h,{style:{flex:1}})]})}),e.jsx(h,{style:{color:g.pageTextLight,marginBottom:10},children:t==="saved"&&i("Existing filters will be cleared")}),e.jsx(v,{direction:"row",align:"flex-start",spacing:1,style:{flexWrap:"wrap"},children:l==="boolean"?e.jsxs(e.Fragment,{children:[e.jsx(C,{op:"true",selected:r===!0,onClick:()=>{u({type:"set-op",op:"is"}),u({type:"set-value",value:!0})}},"true"),e.jsx(C,{op:"false",selected:r===!1,onClick:()=>{u({type:"set-op",op:"is"}),u({type:"set-value",value:!1})}},"false")]}):e.jsxs(e.Fragment,{children:[e.jsx(v,{direction:"row",align:"flex-start",spacing:1,style:{flexWrap:"wrap"},children:o.slice(0,3).map(a=>e.jsx(C,{op:a,selected:a===s,onClick:()=>u({type:"set-op",op:a})},a))}),e.jsx(v,{direction:"row",align:"flex-start",spacing:1,style:{flexWrap:"wrap"},children:o.slice(3,o.length).map(a=>e.jsx(C,{op:a,selected:a===s,onClick:()=>u({type:"set-op",op:a})},a))})]})}),e.jsxs("form",{action:"#",children:[l!=="boolean"&&e.jsx(te,{inputRef:c,field:t,subfield:f,type:l==="id"&&(s==="contains"||s==="matches"||s==="doesNotContain"||s==="hasTags")?"string":l,value:r,multi:s==="oneOf"||s==="notOneOf",style:{marginTop:10},onChange:a=>{u({type:"set-value",value:a})}}),e.jsxs(v,{direction:"row",justify:"flex-end",align:"center",style:{marginTop:15},children:[e.jsx(h,{style:{flex:1}}),e.jsx(j,{type:"primary",onClick:a=>{a.preventDefault(),p({field:t,op:s,value:r,options:pe(t,f)})},children:e.jsx(I,{children:"Apply"})})]})]})]})}function he({onApply:t,compact:n,hover:s,exclude:r}){const{t:u}=k(),p=G(),i=x.useRef(null),f=J()||"MM/dd/yyyy",[d,c]=x.useReducer((l,o)=>{switch(o.type){case"select-field":return{...l,fieldsOpen:!0,condOpen:!1};case"configure":{const{field:a}=K(o.field),y=w.get(a),$=A[y].ops;return{...l,fieldsOpen:!1,condOpen:!0,field:o.field,op:$[0],value:y==="boolean"?!0:null}}case"close":return{fieldsOpen:!1,condOpen:!1,value:null};default:return H(l,o)}},{fieldsOpen:!1,condOpen:!1,field:null,value:null});async function m(l){if(l=N({...l,type:w.get(l.field)}),l.type==="date"&&l.options){if(l.options.month){const y=D(l.value,se(f),new Date);if(E(y))l.value=S(y,"yyyy-MM");else{alert(u("Invalid date format"));return}}else if(l.options.year){const y=D(l.value,"yyyy",new Date);if(E(y))l.value=S(y,"yyyy");else{alert(u("Invalid date format"));return}}}const{error:o}=l.field!=="saved"&&await ne("rule-validate",{conditions:[l],actions:[]}),a=p.find(y=>l.value===y.id);if(o&&o.conditionErrors.length>0){const y=B(F(l.field));alert(y+": "+le(o.conditionErrors[0]))}else t(a||l),c({type:"close"})}return U("f",()=>c({type:"select-field"}),{scopes:["app"]}),e.jsxs(h,{children:[e.jsx(h,{ref:i,children:e.jsx(Z,{style:{...q.tooltip,lineHeight:1.5,padding:"6px 10px"},content:e.jsx(b,{children:e.jsx(I,{children:"Filters"})}),placement:"bottom start",triggerProps:{isDisabled:!s},children:n?e.jsx(de,{onClick:()=>c({type:"select-field"})}):e.jsx(ce,{onClick:()=>c({type:"select-field"})})})}),e.jsx(R,{triggerRef:i,placement:"bottom start",isOpen:d.fieldsOpen,onOpenChange:()=>c({type:"close"}),"data-testid":"filters-select-tooltip",children:e.jsx(Q,{onMenuSelect:l=>{c({type:"configure",field:l})},items:fe.filter(l=>r?!r.includes(l[0]):!0).sort().map(([l,o])=>({name:l,text:B(o)}))})}),e.jsx(R,{triggerRef:i,placement:"bottom start",isOpen:d.condOpen,onOpenChange:()=>{c({type:"close"})},shouldCloseOnInteractOutside:l=>l.dataset.pikaYear?(T=!0,!1):T?(T=!1,!1):!0,style:{width:275,padding:15,color:g.menuItemText},"data-testid":"filters-menu-tooltip",children:d.field&&e.jsx(Y,{field:d.field,op:d.op,value:d.value,dispatch:c,onApply:m})})]})}function ye({field:t,op:n,value:s,options:r,onSave:u,onClose:p}){const[i,f]=x.useReducer((d,c)=>{switch(c.type){case"close":return p(),d;default:return H(d,c)}},{field:t,op:n,value:s,options:r});return e.jsx(Y,{field:i.field,initialSubfield:P({field:t,options:r,value:s}),op:i.op,value:i.value,options:i.options,dispatch:f,onApply:d=>{d=N({...d,type:w.get(d.field)}),u(d),p()}})}let O=!1;function ge({field:t,customName:n,op:s,value:r,options:u,style:p,onChange:i,onDelete:f}){const{t:d}=k(),[c,m]=x.useState(!1),l=x.useRef(null),o=P({field:t,value:r});return e.jsxs(h,{style:{backgroundColor:g.pillBackground,borderRadius:4,flexDirection:"row",alignItems:"center",marginRight:10,marginTop:10,...p},children:[e.jsx(j,{ref:l,type:"bare",disabled:n!=null,onClick:()=>m(!0),children:e.jsx("div",{style:{paddingBlock:1,paddingLeft:5,paddingRight:2},children:n?e.jsx(b,{style:{color:g.pageTextPositive},children:n}):e.jsxs(e.Fragment,{children:[e.jsx(b,{style:{color:g.pageTextPositive},children:F(o,u)})," ",e.jsx(b,{children:M(s,null)})," ",e.jsx(ae,{value:r,field:o,inline:!0,valueIsRaw:s==="contains"||s==="matches"||s==="doesNotContain"||s==="hasTags"})]})})}),e.jsx(j,{type:"bare",onClick:f,"aria-label":d("Delete filter"),children:e.jsx(re,{style:{width:8,height:8,margin:4}})}),e.jsx(R,{triggerRef:l,placement:"bottom start",isOpen:c,onOpenChange:()=>m(!1),shouldCloseOnInteractOutside:a=>a instanceof HTMLElement&&a.dataset.pikaYear?(O=!0,!1):O?(O=!1,!1):!0,style:{width:275,padding:15,color:g.menuItemText},"data-testid":"filters-menu-tooltip",children:e.jsx(ye,{field:t,op:s,value:o==="amount"&&typeof r=="number"?ie(r):r,options:u,onSave:i,onClose:()=>m(!1)})})]})}function me({conditions:t,onUpdate:n,onDelete:s,conditionsOp:r,onConditionsOpChange:u}){return e.jsxs(h,{style:{flexDirection:"row",alignItems:"flex-start",flexWrap:"wrap"},children:[e.jsx(ue,{conditionsOp:r,onChange:u,conditions:t}),t.map((p,i)=>e.jsx(ge,{customName:p.customName,field:p.field,op:p.op,value:p.value,options:p.options,onChange:f=>n(p,f),onDelete:()=>s(p)},i))]})}export{me as A,he as F,oe as M};
//# sourceMappingURL=AppliedFilters.4m6jFtuv.chunk.js.map
